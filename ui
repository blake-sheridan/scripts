#!/usr/bin/env python3

import os
import subprocess
import sys


def main():
    try:
        (_, command, name) = sys.argv
    except ValueError:
        print('Usage:', sys.argv[0], '(select|focus)', '<name>')
        return

    if command == 'select':
        do_select(name)
    elif command == 'focus':
        do_focus(name)
    else:
        raise NotImplementedError


def do_select(name: str):
    result = subprocess.run(['xdotool', 'selectwindow'], stdout=subprocess.PIPE)
    window_id = int(result.stdout.decode())

    with open(get_path(name), 'w') as file:
        file.write(str(window_id))


def do_focus(name: str):
    path = get_path(name)

    with open(path) as file:
        window_id = int(file.read())

    subprocess.run(['xdotool', 'windowactivate', str(window_id)])


def get_path(name: str) -> str:
    display = os.environ['DISPLAY']
    return os.path.join(os.environ['XDG_RUNTIME_DIR'], f'ui-{name}-{display}.id')


if __name__ == '__main__':
    main()
